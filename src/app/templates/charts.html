<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

{% extends "base.html" %}

{% block page_content %}
<div aria-label="An email from Four Track Friday" lang="en" role="article"  style="background-color: white; color: #2b2b2b; font-family: 'Avenir Next', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; margin: 0 auto; max-width: 720px; padding: 40px 20px 40px 20px;">
  <header>
  <a href="">
  <div style="text-align: center;"><img alt="" src="https://4trackfriday.com/logo" width="200"/></div>
  </a>
  <h1 style="color: #000000; font-size: 32px; font-weight: 800; line-height: 32px; margin: 48px 0; text-align: center;">
              4 Track Friday<br/><span style="font-weight: 600;">In Review</span></h1>
  </header>

{% for k,v in metrics.items() %}
  {% if k == 'popularity' %}
  {% set dist = [metrics['popularity']['min']['popularity'], metrics[k]['avg'], metrics['popularity']['max']['popularity']] %}
  {% else %}
  {% set dist = [metrics[k]['min']['features'][k], metrics[k]['avg'], metrics[k]['max']['features'][k]] %}
  {% endif %}
  {% set min_pic = metrics[k]['min']['album']['images'][1]['url'] %}
  {% set max_pic = metrics[k]['max']['album']['images'][1]['url'] %}
  {% set min_name = metrics[k]['min']['name'] %}
  {% set max_name = metrics[k]['max']['name'] %}
  {% set min_artist = metrics[k]['min']['artists'][0]['name'] %}
  {% set max_artist = metrics[k]['max']['artists'][0]['name'] %}
  {% set min_track_url = metrics[k]['min']['external_urls']['spotify'] %}
  {% set max_track_url = metrics[k]['max']['external_urls']['spotify'] %}

  <h2 style="padding-top: 80px;">{{ k.title() }}</h2>
  <div style="display: flex; justify-content: space-between;">
    <div width="25%" style="margin-right: 20px;">
      <a target="_blank" href="{{ min_track_url }}">
        <img class="img-responsive" src="{{ min_pic }}"/>
      </a>
      <h3>{{ min_name }}</h3>
      <h4>{{ min_artist }}</h4>
    </div>
    <div style="float: right; margin-left: 20px;" width="25%">
      <a target="_blank" href="{{ max_track_url }}">
        <img class="img-responsive" src="{{ max_pic }}"/>
      </a>
      <h3>{{ max_name }}</h3>
      <h4>{{ max_artist }}</h4>
    </div>
  </div>
  <div width="600" height="500">
    <canvas id="{{ k }}"></canvas>
    <script>
    var ctx = document.getElementById("{{ k }}").getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'horizontalBar',
        data: {
            labels: ['Min - {{ min_name }}', 'Average', 'Max - {{ max_name }}'],
            datasets: [{
                label: '{{ k }} score',
                data: {{ dist }},
                backgroundColor: [
                    'rgba(178, 0, 253, 0.2)',
                    'rgba(220, 220, 220, 0.2)',
                    'rgba(255, 206, 86, 0.2)'
                ],
                borderColor: [
                    'rgba(178, 0, 253, 1)',
                    'rgba(220, 220, 220, 1)',
                    'rgba(255, 206, 86, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
    </script>
  </div>
{% endfor %}
</div>
{% endblock %}